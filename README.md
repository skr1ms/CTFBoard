# Техническое задание на разработку платформы CTFBoard

**Contributing:** Проект открыт для всех, кто хочет помочь с разработкой бэкенда или фронтенда. Как участвовать: [CONTRIBUTING.md](.github/CONTRIBUTING.md).

## 1. Введение

Целью данного проекта является разработка программного комплекса для проведения соревнований формата Capture The Flag (CTF). Система представляет собой клиент-серверное веб-приложение, обеспечивающее регистрацию участников, выдачу заданий, автоматическую проверку решений (флагов) и отображение турнирной таблицы в режиме реального времени.

## 2. Используемые технологии и инструменты

### 2.1 Серверная часть (Backend)

- **Язык программирования:** Go (версия 1.22 и выше).
- **HTTP-маршрутизация:** Библиотека `chi` (github.com/go-chi/chi/v5) — выбрана для обеспечения строгой совместимости со стандартной библиотекой `net/http` и реализации модульной архитектуры.
- **База данных:** PostgreSQL 17.
- **Драйвер БД:** `pgx/v5` (обеспечение высокой производительности операций ввода-вывода).
- **Аутентификация:** JWT (JSON Web Tokens) согласно стандарту RFC 7519.

### 2.2 Клиентская часть (Frontend)

- **Фреймворк:** React / Vue.js.
- **Взаимодействие с сервером:** RESTful API.
- **Событийная модель:** Server-Sent Events (SSE) для обновления данных без перезагрузки страницы.

## 3. Функциональные требования

### 3.1 Ролевая модель

Система должна поддерживать следующие роли пользователей с разграничением прав доступа:

1.  **Гость (Unauthenticated User):**
    - Просмотр главной страницы и информации о соревновании.
    - Регистрация новой учетной записи (Команды).
    - Аутентификация (Вход в систему).
    - Просмотр публичной турнирной таблицы (Scoreboard).
2.  **Участник (User/Team):**
    - Просмотр списка доступных задач (Challenges).
    - Отправка решения (флага) на проверку.
    - Просмотр статистики собственного профиля.
3.  **Администратор (Admin):**
    - Создание, редактирование и удаление задач.
    - Управление видимостью задач (публикация/скрытие).
    - Мониторинг журнала действий пользователей.

### 3.2 Основные модули системы

#### 3.2.1 Модуль соревнований

- Задачи должны быть разделены по категориям (Web, Crypto, Pwn, Reverse, Forensics, Misc).
- Каждая задача имеет фиксированную или динамическую стоимость в очках.
- Система должна предотвращать повторную отправку верно решенного флага одной командой.

#### 3.2.2 Модуль турнирной таблицы (Scoreboard)

- Отображение рейтинга команд в порядке убывания набранных очков.
- При равенстве очков выше располагается команда, решившая последнюю задачу раньше по времени.
- Обновление данных на клиенте должно происходить автоматически (push-уведомления через SSE) при изменении состояния (сдача флага любым участником).

#### 3.2.3 Модуль безопасности

- **Rate Limiting:** Реализация механизма ограничения частоты запросов для эндпоинта проверки флагов (не более 5 попыток в минуту). При превышении лимита — временная блокировка возможности ввода.
- **Валидация данных:** Строгая проверка входящих данных на соответствие типам и форматам.

## 4. Описание API интерфейса (REST)

Полная документация в SwaggerUI по адресу `https://api.ctfleague.ru/swagger/index.html`.

| Метод      | Эндпоинт                           | Описание                                            | Уровень доступа |
| :--------- | :--------------------------------- | :-------------------------------------------------- | :-------------- |
| **POST**   | `/api/v1/auth/register`            | Регистрация нового участника                        | Public          |
| **POST**   | `/api/v1/auth/login`               | Аутентификация и выдача JWT                         | Public          |
| **POST**   | `/api/v1/auth/forgot-password` | Отправка письма для сброса пароля                   | Public          |
| **POST**   | `/api/v1/auth/reset-password`  | Сброс пароля по токену                              | Public          |
| **GET**    | `/api/v1/auth/me`                  | Получение информации о текущем пользователе         | User            |
| **POST**   | `/api/v1/auth/resend-verification` | Повторная отправка письма подтверждения             | User            |
| **GET**    | `/api/v1/ws`                       | WebSocket соединение для лайв-апдейтов скорборда    | Public          |
| **GET**    | `/api/v1/events`                   | Поток событий SSE (обновление скорборда)            | Public          |
| **GET**    | `/api/v1/scoreboard`               | Получение текущего состояния рейтинга               | Public          |
| **GET**    | `/api/v1/challenges`               | Получение списка задач со статусами решений         | User            |
| **GET**    | `/api/v1/challenges/{id}/first-blood` | Получение информации о First Blood              | Public          |
| **POST**   | `/api/v1/challenges/{id}/submit`   | Отправка флага на проверку. Тело: `{"flag": "..."}` | User            |
| **POST**   | `/api/v1/teams`                    | Создание команды (капитан)                          | User            |
| **POST**   | `/api/v1/teams/join`               | Вступление в команду по токену                      | User            |
| **GET**    | `/api/v1/teams/my`                 | Информация о моей команде (состав, токен)           | User            |
| **GET**    | `/api/v1/teams/{id}`               | Получение информации о команде                      | User            |
| **GET**    | `/api/v1/users/{id}`               | Просмотр публичного профиля игрока                  | Public          |
| **POST**   | `/api/v1/admin/challenges`         | Создание новой задачи                               | Admin           |
| **PUT**    | `/api/v1/admin/challenges/{id}`    | Редактирование задачи                               | Admin           |
| **DELETE** | `/api/v1/admin/challenges/{id}`    | Удаление задачи                                     | Admin           |
| **GET**    | `/api/v1/competition/status`       | Статус соревнования                                 | Public          |
| **GET**    | `/api/v1/admin/competition`        | Настройки соревнования                              | Admin           |
| **PUT**    | `/api/v1/admin/competition`        | Обновление настроек соревнования                    | Admin           |
| **GET**    | `/api/v1/challenges/{challengeId}/hints`    | Список подсказок                                    | User            |
| **POST**   | `/api/v1/challenges/{challengeId}/hints/{hintId}/unlock` | Открытие подсказки                                | User            |
| **POST**   | `/api/v1/admin/challenges/{challengeId}/hints` | Создание подсказки                                  | Admin           |
| **PUT**    | `/api/v1/admin/hints/{id}`         | Редактирование подсказки                            | Admin           |
| **DELETE** | `/api/v1/admin/hints/{id}`         | Удаление подсказки                                  | Admin           |
| **GET**    | `/health`                          | Проверка состояния сервиса                          | Public          |
| **GET**    | `/metrics`                         | Метрики Prometheus                                  | Public          |
| **GET**    | `/swagger/*`                       | Swagger документация                                | Public          |

